% Compile with XeLaTeX, TeXLive 2013 or more recent
\input{../common/config}

\title{Коллективные операции в MPI}

\begin{document}

\begin{frame}
\titlepage
\end{frame}

\section*{Обзор}

\begin{frame}{На прошлой лекции}
\end{frame}

\begin{frame}{На этой лекции}
\tableofcontents
\end{frame} 

% Use [fragile] option to insert listings
% \begin{frame}[fragile]

\begin{frame}[fragile]{MPI_Bcast}

\begin{lstlisting}
int MPI_Bcast(void *buffer, int count, MPI_Datatype datatype, int root, MPI_Comm comm);
\end{lstlisting}

\end{frame}

\section{Функции распределения данных}

\begin{frame}[fragile]{MPI_Scatter}

\begin{lstlisting}
int MPI_Scatter(const void *sendbuf, int sendcount, MPI_Datatype sendtype, void *recvbuf, int recvcount, MPI_Datatype recvtype, int root, MPI_Comm comm);
\end{lstlisting}

\end{frame}

\begin{frame}{MPI_Scatter}

\begin{figure}[htp]
    \centering
    \begin{tikzpicture}
        \node[] (root) {Процесс root};
        \node[below = 2cm of root] (all) {Все процессы};

        \node[draw, fill=orange, rectangle, right= 1cm of root, minimum width= 2cm, minimum height= 0.5cm] (memroot0) {};
        \node[draw, fill=orange, rectangle, right= 0cm of memroot0, minimum width= 2cm, minimum height= 0.5cm] (memroot1) {};
        \node[draw, rectangle, right= 0cm of memroot1, minimum width= 0.2cm, minimum height= 0.5cm, align=center] (etcroot) {...};
        \node[draw, fill=orange, rectangle, right= 0cm of etcroot, minimum width= 2cm, minimum height= 0.5cm] (memrootN) {};

        \node[draw, fill=orange, rectangle, right= 0.75cm of all, minimum width= 2cm, minimum height= 0.5cm] (memall0) {};
        \node[draw, fill=orange, rectangle, right= 0.5cm of memall0, minimum width= 2cm, minimum height= 0.5cm] (memall1) {};
        \node[right= 0cm of memall1, minimum width= 0.2cm, minimum height= 0.5cm, align=center] (etcall) {...};
        \node[draw, fill=orange, rectangle, right= 0cm of etcall, minimum width= 2cm, minimum height= 0.5cm] (memallN) {};

        \path[] (memroot0) -- (memall0) node[draw, rotate=-90, pos=0.5, single arrow, minimum height=1.5cm] {};
        \path[] (memroot1) -- (memall1) node[draw, rotate=-90, pos=0.5, single arrow, minimum height=1.5cm] {};
        \path[] (memrootN) -- (memallN) node[draw, rotate=-90, pos=0.5, single arrow, minimum height=1.5cm] {};
    \end{tikzpicture}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Пример}

\begin{lstlisting}
MPI_Comm comm;
int  rbuf[100], gsize;
int  root, *array;
// ...
MPI_Comm_size(comm, &gsize);
array = (int *) malloc(gsize * 100 * sizeof(int));
// ...
MPI_Scatter(array, 100, MPI_INT, rbuf, 100, MPI_INT, root, comm);
\end{lstlisting}

\end{frame}

\begin{frame}[fragile]{MPI_Scatterv}

\begin{lstlisting}
int MPI_Scatterv(const void *sendbuf, const int *sendcounts, const int *displs, MPI_Datatype sendtype, void *recvbuf, int recvcount, MPI_Datatype recvtype, int root, MPI_Comm comm);
\end{lstlisting}

\end{frame}

\begin{frame}{MPI_Scatterv}

\begin{figure}[htp]
    \centering
    \begin{tikzpicture}
        \node[] (root) {Процесс root};
        \node[below = 2cm of root] (all) {Все процессы};

        \node[draw, fill=orange, rectangle, right= 0.8cm of root, minimum width= 2cm, minimum height= 0.5cm] (memroot0) {};
        \node[draw, rectangle, right= 0cm of memroot0, minimum width= 0.2cm, minimum height= 0.5cm, align=center] (etcroot0) {...};
        \node[draw, fill=brown, rectangle, right= 0cm of etcroot0, minimum width= 2.3cm, minimum height= 0.5cm] (memroot1) {};
        \node[draw, rectangle, right= 0cm of memroot1, minimum width= 0.2cm, minimum height= 0.5cm, align=center] (etcroot1) {...};
        \node[draw, fill=yellow, rectangle, right= 0cm of etcroot1, minimum width= 2cm, minimum height= 0.5cm] (memrootN) {};

        \node[draw, fill=orange, rectangle, right= 0.8cm of all, minimum width= 2cm, minimum height= 0.5cm] (memall0) {};
        \node[right= 0cm of memall0, minimum width= 0.2cm, minimum height= 0.5cm, align=center] (etcall0) {...};
        \node[draw, fill=brown, rectangle, right= 0cm of etcall0, minimum width= 2.3cm, minimum height= 0.5cm] (memall1) {};
        \node[right= 0cm of memall1, minimum width= 0.2cm, minimum height= 0.5cm, align=center] (etcall1) {...};
        \node[draw, fill=yellow, rectangle, right= 0cm of etcall1, minimum width= 2cm, minimum height= 0.5cm] (memallN) {};

        \path[] (memroot0) -- (memall0) node[draw, rotate=-90, pos=0.5, single arrow, minimum height=1.5cm] {};
        \path[] (memroot1) -- (memall1) node[draw, rotate=-90, pos=0.5, single arrow, minimum height=1.5cm] {};
        \path[] (memrootN) -- (memallN) node[draw, rotate=-90, pos=0.5, single arrow, minimum height=1.5cm] {};
    \end{tikzpicture}
\end{figure}

\end{frame}

\section{Функции сбора данных}

\begin{frame}[fragile]{MPI_Gather}

\begin{lstlisting}
int MPI_Gather(const void *sendbuf, int sendcount, MPI_Datatype sendtype, void *recvbuf, int recvcount, MPI_Datatype recvtype, int root, MPI_Comm comm);
\end{lstlisting}

\end{frame}

\begin{frame}

\begin{figure}[htp]
    \centering
    \begin{tikzpicture}
        \node[] (root) {Процесс root};
        \node[below = 2cm of root] (all) {Все процессы};

        \node[draw, fill=orange, rectangle, right= 1cm of root, minimum width= 2cm, minimum height= 0.5cm] (memroot0) {};
        \node[draw, fill=orange, rectangle, right= 0cm of memroot0, minimum width= 2cm, minimum height= 0.5cm] (memroot1) {};
        \node[draw, rectangle, right= 0cm of memroot1, minimum width= 0.2cm, minimum height= 0.5cm, align=center] (etcroot) {...};
        \node[draw, fill=orange, rectangle, right= 0cm of etcroot, minimum width= 2cm, minimum height= 0.5cm] (memrootN) {};

        \node[draw, fill=orange, rectangle, right= 0.75cm of all, minimum width= 2cm, minimum height= 0.5cm] (memall0) {};
        \node[draw, fill=orange, rectangle, right= 0.5cm of memall0, minimum width= 2cm, minimum height= 0.5cm] (memall1) {};
        \node[right= 0cm of memall1, minimum width= 0.2cm, minimum height= 0.5cm, align=center] (etcall) {...};
        \node[draw, fill=orange, rectangle, right= 0cm of etcall, minimum width= 2cm, minimum height= 0.5cm] (memallN) {};

        \path[] (memall0) -- (memroot0) node[draw, rotate=90, pos=0.5, single arrow, minimum height=1.5cm] {};
        \path[] (memall1) -- (memroot1) node[draw, rotate=90, pos=0.5, single arrow, minimum height=1.5cm] {};
        \path[] (memallN) -- (memrootN) node[draw, rotate=90, pos=0.5, single arrow, minimum height=1.5cm] {};
    \end{tikzpicture}
\end{figure}

\end{frame}

\section*{Конец}
% The final "thank you" frame 

\begin{frame}{Задания}
\end{frame}

\begin{frame}{На следующей лекции}
\end{frame}

\begin{frame}

{\huge{Спасибо за внимание!}\par}

\vfill

\tiny{\textit{Замечание}: все торговые марки и логотипы, использованные в данном материале, являются собственностью их владельцев. Представленная здесь точка зрения отражает личное мнение автора, не выступающего от лица какой-либо организации.}

\end{frame}

\end{document}
